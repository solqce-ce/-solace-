<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è¨­å®š - Palette Generator Pro</title>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-17HK77SMHP"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-17HK77SMHP');
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #334155;
      --primary-dark: #1e293b;
      --success: #059669;
      --danger: #dc2626;
      --text-dark: #0f172a;
      --text-light: #64748b;
      --bg-light: #f8fafc;
      --shadow: 0 4px 12px rgba(15, 23, 42, 0.08);
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html.light {
      background: #ffffff;
      color: var(--text-dark);
    }

    html.dark {
      background: #1e293b;
      color: #e2e8f0;
    }

    body {
      font-family: 'Plus Jakarta Sans', -apple-system, sans-serif;
      line-height: 1.6;
      transition: var(--transition);
      padding: 0;
      min-height: 100vh;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 80px 40px;
    }

    .page-header {
      margin-bottom: 60px;
      padding-bottom: 40px;
      border-bottom: 3px solid #334155;
    }

    html.dark .page-header {
      border-bottom-color: #64748b;
    }

    .page-header h1 {
      font-family: 'Syne', sans-serif;
      font-size: 3rem;
      font-weight: 800;
      margin-bottom: 16px;
      letter-spacing: -1px;
      color: var(--text-dark);
    }

    html.dark .page-header h1 {
      color: #f1f5f9;
    }

    .page-header p {
      font-size: 1.15rem;
      opacity: 0.9;
      font-weight: 500;
    }

    .settings-grid {
      display: grid;
      gap: 24px;
    }

    .settings-card {
      background: rgba(255, 255, 255, 0.95);
      border: none; border-left: 5px solid #334155;
      border-radius: 0;
      padding: 28px;
      box-shadow: none;
      transition: var(--transition);
    }

    html.dark .settings-card {
      background: rgba(71, 85, 105, 0.9);
      border-color: rgba(255, 255, 255, 0.08);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .settings-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(51, 65, 85, 0.1);
    }

    .settings-card-header {
      margin-bottom: 16px;
      padding-bottom: 16px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.06);
    }

    html.dark .settings-card-header {
      border-bottom-color: rgba(255, 255, 255, 0.06);
    }

    .settings-card h3 {
      font-family: 'Syne', sans-serif;
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--text-dark);
    }

    html.dark .settings-card h3 {
      color: #f1f5f9;
    }

    .settings-card p {
      opacity: 0.9;
      margin-bottom: 16px;
      line-height: 1.6;
      font-size: 1rem;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: var(--transition);
      font-family: 'Plus Jakarta Sans', -apple-system, sans-serif;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      margin-right: 8px;
      margin-bottom: 8px;
    }

    .btn:hover {
      transform: translateY(-2px);
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
      box-shadow: 0 6px 16px rgba(51, 65, 85, 0.3);
    }

    .btn-primary:hover {
      box-shadow: 0 8px 20px rgba(51, 65, 85, 0.4);
    }

    .btn-secondary {
      background: rgba(51, 65, 85, 0.1);
      color: var(--primary);
      border: 2px solid var(--primary);
    }

    html.dark .btn-secondary {
      background: rgba(148, 163, 184, 0.2);
      color: #e2e8f0;
      border-color: #94a3b8;
    }

    .btn-secondary:hover {
      background: var(--primary);
      color: white;
    }

    .btn-success {
      background: var(--success);
      color: white;
      box-shadow: 0 6px 16px rgba(16, 185, 129, 0.3);
    }

    .btn-success:hover {
      box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
    }

    .btn-danger {
      background: var(--danger);
      color: white;
      box-shadow: 0 6px 16px rgba(239, 68, 68, 0.3);
    }

    .btn-danger:hover {
      background: #dc2626;
      box-shadow: 0 8px 20px rgba(239, 68, 68, 0.4);
    }

    .danger-zone {
      border-left: 4px solid var(--danger);
      background: rgba(239, 68, 68, 0.05);
    }

    html.dark .danger-zone {
      background: rgba(127, 29, 29, 0.45);
    }

    .setting-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid rgba(0, 0, 0, 0.04);
    }

    html.dark .setting-item {
      border-bottom-color: rgba(255, 255, 255, 0.04);
    }

    .setting-item:last-child {
      border-bottom: none;
    }

    .setting-label {
      font-weight: 600;
      font-size: 1rem;
    }

    .setting-description {
      font-size: 0.95rem;
      opacity: 0.85;
      margin-top: 2px;
    }

    .toggle-switch {
      width: 44px;
      height: 24px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 0;
      cursor: pointer;
      position: relative;
      transition: var(--transition);
    }

    .toggle-switch.on {
      background: var(--success);
    }

    .toggle-switch::after {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      background: white;
      border-radius: 50%;
      top: 2px;
      left: 2px;
      transition: var(--transition);
    }

    .toggle-switch.on::after {
      left: 22px;
    }

    .toggle-switch-btn {
      border: none;
      padding: 0;
    }

    .muted-meta {
      opacity: 0.9;
    }

    @media (max-width: 768px) {
      body {
        padding: 30px 16px 50px;
      }

      .page-header h1 {
        font-size: 1.8rem;
      }

      .settings-grid {
        grid-template-columns: 1fr;
        gap: 16px;
      }

      .settings-card {
        padding: 24px;
      }

      .btn {
        width: 100%;
        justify-content: center;
      }
    }

    @media (max-width: 480px) {
      .page-header h1 {
        font-size: 1.5rem;
      }

      .settings-card {
        padding: 16px;
        border-radius: 0;
      }

      .settings-card-header h3 {
        font-size: 1rem;
      }

      .btn {
        width: 100%;
        padding: 10px 14px;
        font-size: 0.85rem;
      }

      .setting-item {
        padding: 10px 0;
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }

      .toggle-switch {
        align-self: flex-end;
      }
    }
  </style>
</head>
<body>
  <nav id="mainNav"></nav>

  <div class="container">
    <div class="page-header">
      <h1>âš™ï¸ è¨­å®š</h1>
      <p>ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è¨­å®šã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã¾ã™</p>
    </div>    <div class="history-nav" id="historyNav"></div>
    <div class="settings-grid">
      <!-- ãƒ†ãƒ¼ãƒè¨­å®š -->
      <div class="settings-card">
        <div class="settings-card-header">
          <h3>ğŸŒ™ å¤–è¦³è¨­å®š</h3>
        </div>
        <p>ãƒ€ãƒ¼ã‚¯/ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰ã‚’åˆ‡ã‚Šæ›¿ãˆã¦ã€å¿«é©ãªç’°å¢ƒã‚’ä½œã‚Šã¾ã—ã‚‡ã†ã€‚</p>
        <button type="button" id="toggleThemeBtn" class="btn btn-secondary">ğŸ’¡ ãƒ†ãƒ¼ãƒã‚’åˆ‡ã‚Šæ›¿ãˆ</button>
      </div>

      <!-- ãƒ‡ãƒ¼ã‚¿ç®¡ç† -->
      <div class="settings-card">
        <div class="settings-card-header">
          <h3>ğŸ“¦ ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h3>
        </div>
        <p>ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã•ã‚ŒãŸã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ï¼ˆä½œå“ã€ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆã€ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ï¼‰ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¾ãŸã¯ãƒªã‚»ãƒƒãƒˆã§ãã¾ã™ã€‚</p>
        <button type="button" id="exportDataBtn" class="btn btn-success">ğŸ“¥ ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
        <button type="button" id="importDataBtn" class="btn btn-secondary">ğŸ“¤ ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
      </div>

      <!-- é€šçŸ¥è¨­å®š -->
      <div class="settings-card">
        <div class="settings-card-header">
          <h3>ğŸ”” é€šçŸ¥è¨­å®š</h3>
        </div>
        <div class="setting-item">
          <div>
            <div class="setting-label">ä¿å­˜é€šçŸ¥</div>
            <div class="setting-description">ä½œå“ä¿å­˜æ™‚ã«é€šçŸ¥ã‚’è¡¨ç¤º</div>
          </div>
          <button type="button" class="toggle-switch toggle-switch-btn on" data-toggle-key="saveNotice" aria-label="ä¿å­˜é€šçŸ¥" aria-pressed="true"></button>
        </div>
        <div class="setting-item">
          <div>
            <div class="setting-label">å‰Šé™¤ç¢ºèª</div>
            <div class="setting-description">å‰Šé™¤å‰ã«ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤º</div>
          </div>
          <button type="button" class="toggle-switch toggle-switch-btn on" data-toggle-key="deleteConfirm" aria-label="å‰Šé™¤ç¢ºèª" aria-pressed="true"></button>
        </div>
      </div>

      <!-- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­å®š -->
      <div class="settings-card">
        <div class="settings-card-header">
          <h3>âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</h3>
        </div>
        <div class="setting-item">
          <div>
            <div class="setting-label">è‡ªå‹•ä¿å­˜</div>
            <div class="setting-description">å®šæœŸçš„ã«ä½œå“ã‚’è‡ªå‹•ä¿å­˜</div>
          </div>
          <button type="button" class="toggle-switch toggle-switch-btn on" data-toggle-key="autoSave" aria-label="è‡ªå‹•ä¿å­˜" aria-pressed="true"></button>
        </div>
        <div class="setting-item">
          <div>
            <div class="setting-label">ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³</div>
            <div class="setting-description">ã‚¹ãƒ ãƒ¼ã‚ºãªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŠ¹æœã‚’æœ‰åŠ¹</div>
          </div>
          <button type="button" class="toggle-switch toggle-switch-btn on" data-toggle-key="animation" aria-label="ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³" aria-pressed="true"></button>
        </div>
      </div>

      <!-- å±é™ºã‚¾ãƒ¼ãƒ³ -->
      <div class="settings-card danger-zone">
        <div class="settings-card-header">
          <h3>âš ï¸ å±é™ºã‚¾ãƒ¼ãƒ³</h3>
        </div>
        <p>âš¡ æ³¨æ„ï¼šã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ãŒå‰Šé™¤ã•ã‚Œã¾ã™ã€‚</p>
        <button type="button" id="resetAllDataBtn" class="btn btn-danger">ğŸ—‘ï¸ ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤</button>
      </div>

      <!-- ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ± -->
      <div class="settings-card">
        <div class="settings-card-header">
          <h3>â„¹ï¸ ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±</h3>
        </div>
        <div class="setting-item">
          <div>
            <div class="setting-label">ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³</div>
            <div class="setting-description">Palette Generator Pro</div>
          </div>
          <span class="muted-meta">v1.0</span>
        </div>
        <div class="setting-item">
          <div>
            <div class="setting-label">æœ€çµ‚æ›´æ–°</div>
            <div class="setting-description">2024å¹´2æœˆ27æ—¥</div>
          </div>
          <span class="muted-meta">Latest</span>
        </div>
      </div>
    </div>
  </div>

  <input type="file" id="importFile" class="d-none" accept=".json">

  <script>
    (function(){
      const t = localStorage.getItem('pgp.theme') || localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme:dark)').matches ? 'dark' : 'light');
      document.documentElement.className = t;
    })();
  </script>

  <script src="common.js"></script>
  <script>
    function resetAllData() {
      if (!confirmAction('âš ï¸ æœ¬å½“ã«ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
        return;
      }

      if (!confirmAction('ğŸš¨ ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
        return;
      }

      const keys = [
        'profile',
        'stats',
        'gallery',
        'theme',
        'favorites',
        'visitHistory',
        'randomColorSettings',
        'emojiSettings',
        'appSettings'
      ];

      keys.forEach((key) => removeRawData(key));
      showToast('âœ… ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¾ã™...', 2000, 'success');
      setTimeout(() => location.reload(), 1500);
    }

    function getSettingsState() {
      const defaults = {
        saveNotice: true,
        deleteConfirm: true,
        autoSave: true,
        animation: true
      };

      const saved = loadData('appSettings', defaults);
      return { ...defaults, ...(saved || {}) };
    }

    function persistSettingsState(nextState) {
      saveData('appSettings', nextState);
    }

    function applyToggleButtonState(button, enabled) {
      button.classList.toggle('on', enabled);
      button.setAttribute('aria-pressed', enabled ? 'true' : 'false');
    }

    function exportAllData() {
      const allData = {
        profile: loadData('profile', null),
        stats: loadData('stats', null),
        gallery: loadData('gallery', null),
        theme: getThemePreference(),
        favorites: loadData('favorites', []),
        visitHistory: loadData('visitHistory', []),
        randomColorSettings: loadData('randomColorSettings', null),
        emojiSettings: loadData('emojiSettings', null),
        appSettings: loadData('appSettings', null),
        exportDate: new Date().toISOString()
      };
      const dataStr = JSON.stringify(allData, null, 2);
      const blob = new Blob([dataStr], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `palette-backup-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
      showToast('ğŸ“¥ ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ', 2000, 'success');
    }

    function parseMaybeJSONString(value) {
      if (typeof value !== 'string') {
        return value;
      }

      const trimmed = value.trim();
      if (!trimmed) {
        return value;
      }

      try {
        return JSON.parse(trimmed);
      } catch (_) {
        return value;
      }
    }

    function importData() {
      document.getElementById('importFile').click();
    }

    document.getElementById('importFile').addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (ev) => {
        try {
          const data = JSON.parse(ev.target.result);

          if (data.profile !== undefined) saveData('profile', parseMaybeJSONString(data.profile));
          if (data.stats !== undefined) saveData('stats', parseMaybeJSONString(data.stats));
          if (data.gallery !== undefined) saveData('gallery', parseMaybeJSONString(data.gallery));
          if (data.theme) setThemePreference(String(data.theme));
          if (Array.isArray(data.favorites)) saveData('favorites', data.favorites);
          if (Array.isArray(data.visitHistory)) saveData('visitHistory', data.visitHistory);
          if (data.randomColorSettings && typeof data.randomColorSettings === 'object') {
            saveData('randomColorSettings', data.randomColorSettings);
          }
          if (data.emojiSettings && typeof data.emojiSettings === 'object') {
            saveData('emojiSettings', data.emojiSettings);
          }
          if (data.appSettings && typeof data.appSettings === 'object') {
            saveData('appSettings', data.appSettings);
          }

          showToast('âœ… ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ', 2000, 'success');
          setTimeout(() => location.reload(), 1000);
        } catch(err) {
          showToast('âŒ ãƒ•ã‚¡ã‚¤ãƒ«ãŒç„¡åŠ¹ã§ã™', 2000, 'error');
        }
      };
      reader.readAsText(file);
    });

    document.addEventListener('DOMContentLoaded', () => {
      buildNav('settings');
      buildHistoryNav('settings-enterprise.html');

      const toggleButtons = Array.from(document.querySelectorAll('.toggle-switch-btn'));
      const state = getSettingsState();

      toggleButtons.forEach((button) => {
        const key = button.dataset.toggleKey;
        applyToggleButtonState(button, Boolean(state[key]));

        button.addEventListener('click', () => {
          const current = button.getAttribute('aria-pressed') === 'true';
          const next = !current;
          applyToggleButtonState(button, next);
          state[key] = next;
          persistSettingsState(state);
          showToast(`âš™ï¸ ${key} ã‚’${next ? 'æœ‰åŠ¹' : 'ç„¡åŠ¹'}ã«ã—ã¾ã—ãŸ`, 1200, 'info');
        });
      });

      document.getElementById('toggleThemeBtn').addEventListener('click', () => {
        toggleTheme();
        setTimeout(() => location.reload(), 300);
      });

      document.getElementById('exportDataBtn').addEventListener('click', exportAllData);
      document.getElementById('importDataBtn').addEventListener('click', importData);
      document.getElementById('resetAllDataBtn').addEventListener('click', resetAllData);
    });
  </script>
</body>
</html>
