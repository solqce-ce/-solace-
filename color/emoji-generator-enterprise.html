<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ÁµµÊñáÂ≠ó„Ç∏„Çß„Éç„É¨„Éº„Çø„Éº - Palette Generator Pro</title>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-17HK77SMHP"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-17HK77SMHP');
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #334155;
      --primary-dark: #1e293b;
      --success: #059669;
      --danger: #dc2626;
      --text-dark: #0f172a;
      --text-light: #64748b;
      --bg-light: #f8fafc;
      --shadow: 0 4px 12px rgba(15, 23, 42, 0.08);
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html.light {
      background: #ffffff;
      color: var(--text-dark);
    }

    html.dark {
      background: #1e293b;
      color: #e2e8f0;
    }

    body {
      font-family: 'Plus Jakarta Sans', -apple-system, sans-serif;
      line-height: 1.6;
      transition: var(--transition);
      padding: 0;
      min-height: 100vh;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 80px 40px;
    }

    .page-header {
      margin-bottom: 60px;
      padding-bottom: 40px;
      border-bottom: 3px solid #334155;
    }

    html.dark .page-header {
      border-bottom-color: #64748b;
    }

    .page-header h1 {
      font-family: 'Syne', sans-serif;
      font-size: 3rem;
      font-weight: 800;
      margin-bottom: 16px;
      letter-spacing: -1px;
      color: var(--text-dark);
    }

    html.dark .page-header h1 {
      color: #f1f5f9;
    }

    .page-header p {
      font-size: 1.15rem;
      opacity: 0.9;
      font-weight: 500;
    }

    .controls {
      background: rgba(255, 255, 255, 0.95);
      border: none; border-left: 5px solid #334155;
      border-radius: 0;
      padding: 32px;
      margin-bottom: 40px;
      box-shadow: none;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 24px;
      align-items: center;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    html.dark .controls {
      background: rgba(51, 65, 85, 0.9);
      border-color: rgba(51, 65, 85, 0.2);
      box-shadow: 0 8px 24px rgba(51, 65, 85, 0.08);
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    label {
      font-weight: 700;
      font-size: 0.95rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-dark);
    }

    html.dark label {
      color: #b0b8d8;
    }

    .category-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .category-btn {
      padding: 8px 14px;
      background: rgba(0, 212, 255, 0.08);
      color: #00d4ff;
      border: 2px solid #00d4ff;
      border-radius: 8px;
      font-weight: 600;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      font-family: 'Plus Jakarta Sans', -apple-system, sans-serif;
    }

    .category-btn:hover {
      background: #00d4ff;
      color: #0a0e27;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 212, 255, 0.3);
    }

    .category-btn.active {
      background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
      color: white;
      border-color: transparent;
      box-shadow: 0 4px 12px rgba(0, 212, 255, 0.4);
    }

    html.dark .category-btn {
      background: rgba(0, 212, 255, 0.15);
      border-color: #00d4ff;
      color: #00ffff;
    }

    html.dark .category-btn:hover {
      background: #00d4ff;
      color: #0a0e27;
    }

    html.dark .category-btn.active {
      background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
      color: white;
      border-color: transparent;
    }

    input, select {
      padding: 10px 14px;
      border: 1px solid rgba(0, 0, 0, 0.1);
      border-radius: 8px;
      font-family: 'Plus Jakarta Sans', -apple-system, sans-serif;
      font-size: 0.9rem;
      background: rgba(255, 255, 255, 0.95);
      color: var(--text-dark);
      transition: var(--transition);
    }

    html.dark input,
    html.dark select {
      background: rgba(71, 85, 105, 0.9);
      border-color: rgba(255, 255, 255, 0.08);
      color: #e2e8f0;
    }

    input:focus, select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(51, 65, 85, 0.1);
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      font-size: 0.9rem;
      cursor: pointer;
      transition: var(--transition);
      font-family: 'Plus Jakarta Sans', -apple-system, sans-serif;
      letter-spacing: 0.3px;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
      box-shadow: 0 6px 16px rgba(51, 65, 85, 0.3);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(51, 65, 85, 0.4);
    }

    .btn-secondary {
      background: rgba(0, 212, 255, 0.1);
      color: #00d4ff;
      border: 2px solid #00d4ff;
    }

    .btn-secondary:hover {
      background: #00d4ff;
      color: #0a0e27;
      transform: translateY(-2px);
    }

    .btn-secondary.active {
      background: #00d4ff;
      color: #0a0e27;
    }

    .emoji-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }

    .emoji-item {
      padding: 24px 16px;
      border-radius: 0;
      background: rgba(255, 255, 255, 0.95);
      border: 1px solid #e2e8f0;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
      text-align: center;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .emoji-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s;
    }

    .emoji-item:hover::before {
      left: 100%;
    }

    html.dark .emoji-item {
      background: rgba(71, 85, 105, 0.9);
      border-color: rgba(51, 65, 85, 0.15);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
    }

    .emoji-item:hover {
      transform: translateY(-6px) scale(1.02);
      box-shadow: 0 16px 40px rgba(51, 65, 85, 0.25);
      border-color: rgba(51, 65, 85, 0.4);
      background: rgba(255, 255, 255, 0.98);
    }

    html.dark .emoji-item:hover {
      background: rgba(51, 65, 85, 0.9);
    }

    .emoji-large {
      font-size: 3rem;
      margin-bottom: 8px;
    }

    .emoji-name {
      font-size: 0.95rem;
      font-weight: 600;
      opacity: 0.9;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      background: rgba(51, 65, 85, 0.08);
      border: 2px dashed rgba(51, 65, 85, 0.3);
      border-radius: 0;
      margin-bottom: 40px;
    }

    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 16px;
    }

    .empty-state h2 {
      font-family: 'Syne', sans-serif;
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .empty-state p {
      opacity: 0.9;
      margin-bottom: 20px;
    }

    @media (max-width: 768px) {
      body {
        padding: 30px 16px 50px;
      }

      .page-header h1 {
        font-size: 1.8rem;
      }

      .controls {
        flex-direction: column;
        align-items: stretch;
      }

      .form-group {
        width: 100%;
      }

      input, select, .btn {
        width: 100%;
      }

      .emoji-grid {
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        gap: 12px;
      }
    }

    @media (max-width: 768px) {
      .controls {
        grid-template-columns: 1fr;
        padding: 24px;
        gap: 16px;
      }

      .emoji-grid {
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        gap: 12px;
      }

      .emoji-item {
        padding: 16px 12px;
        border-radius: 0;
      }

      .emoji-large {
        font-size: 2.5rem;
      }
    }

    @media (max-width: 480px) {
      .controls {
        grid-template-columns: 1fr;
        padding: 16px;
        gap: 12px;
      }

      .form-group {
        gap: 6px;
      }

      .emoji-grid {
        grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
        gap: 8px;
      }

      .emoji-item {
        padding: 12px 8px;
        border-radius: 0;
      }

      .emoji-large {
        font-size: 2rem;
      }

      .emoji-name {
        font-size: 0.75rem;
      }
    }
  </style>
</head>
<body>
  <nav id="mainNav"></nav>

  <div class="container">
    <div class="page-header">
      <h1>üòä ÁµµÊñáÂ≠ó„Ç∏„Çß„Éç„É¨„Éº„Çø„Éº</h1>
      <p>„Ç´„Çπ„Çø„É†ÁµµÊñáÂ≠ó„ÇíËá™Áî±„Å´‰ΩúÊàê„ÉªÁÆ°ÁêÜ„Åß„Åç„Åæ„Åô</p>
    </div>
    <div class="history-nav" id="historyNav"></div>

    <div class="controls">
      <div class="form-group">
        <label>„Ç´„ÉÜ„Ç¥„É™ÔºàË§áÊï∞ÈÅ∏ÊäûÂèØÔºâ</label>
        <div class="category-buttons" id="categoryButtons">
          <button type="button" class="category-btn active" data-category="all">„Åô„Åπ„Å¶</button>
          <button type="button" class="category-btn" data-category="face">È°î</button>
          <button type="button" class="category-btn" data-category="nature">Ëá™ÁÑ∂</button>
          <button type="button" class="category-btn" data-category="food">È£ü„ÅπÁâ©</button>
          <button type="button" class="category-btn" data-category="activity">Ê¥ªÂãï</button>
          <button type="button" class="category-btn" data-category="objects">„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà</button>
        </div>
      </div>

      <div class="form-group">
        <label for="countSelect">Êï∞</label>
        <select id="countSelect">
          <option value="1">1ÂÄã</option>
          <option value="2">2ÂÄã</option>
          <option value="3">3ÂÄã</option>
          <option value="4">4ÂÄã</option>
          <option value="5">5ÂÄã</option>
          <option value="6">6ÂÄã</option>
          <option value="7">7ÂÄã</option>
          <option value="8">8ÂÄã</option>
          <option value="9">9ÂÄã</option>
          <option value="10" selected>10ÂÄã</option>
        </select>
      </div>

      <button type="button" id="generateEmojisBtn" class="btn btn-primary">üé≤ „Ç∏„Çß„Éç„É¨„Éº„Éà</button>
      <button type="button" id="clearEmojisBtn" class="btn btn-secondary">üóëÔ∏è „ÇØ„É™„Ç¢</button>
      <button id="copyAllBtn" class="btn btn-secondary">üìã ÂÖ®ÈÉ®„Ç≥„Éî„Éº</button>
      <button id="saveImgBtn" class="btn btn-secondary">üñºÔ∏è ÁîªÂÉè‰øùÂ≠ò</button>
    </div>

    <div id="emojiContainer" class="empty-state">
      <div class="empty-state-icon">üòä</div>
      <h2>ÁµµÊñáÂ≠ó„Çí‰ΩúÊàê</h2>
      <p>„Äå„Ç∏„Çß„Éç„É¨„Éº„Éà„Äç„Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„ÄÅÁµµÊñáÂ≠ó„Çí‰ΩúÊàê„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
    </div>

    <div class="emoji-grid d-none" id="emojiGrid"></div>
  </div>

  <script src="common.js"></script>
  <script>
    const emojis = {
      face: ['üòÄ', 'üòÉ', 'üòÑ', 'üòÅ', 'üòÜ', 'üòÖ', 'ü§£', 'üòÇ', 'üòâ', 'üòä', 'üòá', 'üôÇ', 'üôÉ', 'üòå', 'üòî', 'üòç', 'ü•∞', 'üòò', 'üòó', 'üòö', 'üòô', 'ü•≤', 'üòã', 'üòõ', 'üòú', 'ü§™', 'üòå', 'üòë', 'üòê', 'üòè', 'üòí', 'üôÅ', 'üò¨', 'ü§•', 'üòå', 'üòî', 'üò™', 'ü§§', 'üò¥', 'üò∑', 'ü§í', 'ü§ï', 'ü§Æ', 'ü§¢', 'ü§Æ', 'ü§í', 'üòµ', 'ü§Ø', 'ü§†', 'ü•≥', 'üòé', 'ü§ì', 'üßê', 'üòï', 'üòü', 'üôÅ', '‚òπÔ∏è', 'üòÆ', 'üòØ', 'üò≤', 'üò≥', 'ü•∫', 'üò¶', 'üòß', 'üò®', 'üò∞', 'üò•', 'üò¢', 'üò≠', 'üò±', 'üòñ', 'üò£', 'üòû', 'üòì', 'üò©', 'üò´', 'ü•±', 'üò§', 'üò°', 'üò†', 'ü§¨', 'üòà', 'üëø', 'üíÄ', '‚ò†Ô∏è', 'üí©', 'ü§°', 'üëπ', 'üë∫', 'üëª', 'üëΩ', 'üëæ', 'ü§ñ', 'üò∫', 'üò∏', 'üòπ', 'üòª', 'üòº', 'üòΩ', 'üôÄ', 'üòø', 'üòæ'],
      nature: ['üê∂', 'üê±', 'üê≠', 'üêπ', 'üê∞', 'ü¶ä', 'üêª', 'üêº', 'üê®', 'üêØ', 'ü¶Å', 'üêÆ', 'üê∑', 'üê∏', 'üêµ', 'üôà', 'üôâ', 'üôä', 'üêí', 'üêî', 'üêß', 'üê¶', 'üê§', 'ü¶Ü', 'ü¶Ö', 'ü¶â', 'ü¶á', 'üê∫', 'üêó', 'üê¥', 'ü¶Ñ', 'üêù', 'ü™±', 'üêõ', 'ü¶ã', 'üêå', 'üêû', 'üêú', 'ü™∞', 'ü™≤', 'ü¶ü', 'ü¶ó', 'üï∑Ô∏è', 'ü¶Ç', 'üê¢', 'üêç', 'ü¶é', 'ü¶ñ', 'ü¶ï', 'üêô', 'ü¶ë', 'ü¶ê', 'ü¶û', 'ü¶Ä', 'üê°', 'üê†', 'üêü', 'üê¨', 'üê≥', 'üêã'],
      food: ['üçè', 'üçé', 'üçê', 'üçä', 'üçã', 'üçå', 'üçâ', 'üçá', 'üçì', 'üçà', 'üçí', 'üçë', 'ü•≠', 'üçç', 'ü••', 'ü•ë', 'üçÜ', 'üçÖ', 'üå∂Ô∏è', 'üåΩ', 'ü•í', 'ü•¨', 'ü•¶', 'üßÑ', 'üßÖ', 'üçÑ', 'ü•ú', 'üå∞', 'üçû', 'ü•ê', 'ü•ñ', 'ü•®', 'ü•Ø', 'ü•û', 'üßá', 'ü•ö', 'üç≥', 'üßà', 'ü•û', 'ü•ì', 'ü•û', 'üçó', 'üçñ', 'üå≠', 'üçî', 'üçü', 'üçï', 'ü•™', 'ü•ô', 'üßÜ', 'üåÆ', 'üåØ', 'ü•ó', 'ü•ò', 'ü•´', 'üçù', 'üçú', 'üç≤', 'üçõ', 'üç£', 'üç±', 'ü•ü', 'ü¶™', 'üç§', 'üçô', 'üçö', 'üçò', 'üç•', 'ü•†', 'ü•Æ', 'üç¢', 'üç°', 'üçß', 'üç®', 'üç¶', 'üç∞', 'üéÇ', 'üßÅ', 'üçÆ', 'üç≠', 'üç¨', 'üç´', 'üçø', 'üç©', 'üç™', 'üå∞', 'üçØ', 'ü•õ', 'üçº', '‚òï', 'üçµ', 'üç∂', 'üçæ', 'üç∑', 'üç∏', 'üçπ', 'üç∫', 'üçª', 'ü•Ç', 'ü•É'],
      activity: ['‚öΩ', 'üèÄ', 'üèà', '‚öæ', 'ü•é', 'üéæ', 'üèê', 'üèâ', 'ü•è', 'üé≥', 'üèì', 'üè∏', 'üèí', 'üèë', 'ü•ç', 'üèåÔ∏è', '‚õ≥', 'üé£', 'üéΩ', 'üéø', '‚õ∑Ô∏è', 'üèÇ', 'ü™Ç', 'üõº', 'üõπ', 'üõ∑', 'ü•å', 'üéØ', 'ü™Ä', 'ü™É', 'üé™', 'üé®', 'üé¨', 'üé§', 'üéß', 'üéº', 'üéπ', 'ü•Å', 'üé∑', 'üé∫', 'üé∏', 'ü™î', 'üéª', 'üé≤', '‚ôüÔ∏è', 'üéØ', 'üé≥', 'üéÆ', 'üé∞'],
      objects: ['üì±', 'üì≤', 'üíª', '‚å®Ô∏è', 'üñ•Ô∏è', 'üñ®Ô∏è', 'üñ±Ô∏è', 'üñ≤Ô∏è', 'üïπÔ∏è', 'üóúÔ∏è', 'üíΩ', 'üíæ', 'üíø', 'üìÄ', 'üßÆ', 'üé•', 'üé¨', 'üì∫', 'üì∑', 'üì∏', 'üìπ', 'üéûÔ∏è', 'üìû', '‚òéÔ∏è', 'üìü', 'üì†', 'üì∫', 'üìª', 'üéôÔ∏è', 'üéöÔ∏è', 'üéõÔ∏è', 'üß≠', '‚è±Ô∏è', '‚è≤Ô∏è', '‚è∞', 'üï∞Ô∏è', '‚åö', '‚åõ', '‚è≥', 'üì°', 'üîã', 'üîå', 'üí°', 'üî¶', 'üïØÔ∏è', 'ü™î', 'üßØ', 'üõ¢Ô∏è', 'üí∏', 'üíµ', 'üí¥', 'üí∂', 'üí∑', 'üí∞', 'üí≥', 'üßæ', '‚úâÔ∏è', 'üì©', 'üì®', 'üì§', 'üì•', 'üì¶', 'üè∑Ô∏è', 'üßß', 'üì™', 'üì´', 'üì¨', 'üì≠', 'üìÆ', 'üìØ', 'üìú', 'üìÉ', 'üìÑ', 'üìë', 'üßæ', 'üßª', 'üìñ', 'üìï', 'üìó', 'üìò', 'üìô', 'üìö', 'üìì', 'üìî', 'üìí', 'üìë', 'üßí', 'üìê', 'üìè', 'üßÆ', 'üìå', 'üìç', '‚úÇÔ∏è', 'üñäÔ∏è', 'üñãÔ∏è', '‚úíÔ∏è', 'üñåÔ∏è', 'üñçÔ∏è', 'üìù', '‚úèÔ∏è', 'üîç', 'üîé']
    };

    let selectedCategories = ['all'];
    let countSelectRef = null;

    function loadEmojiSettings() {
      const s = loadData('emojiSettings', {});
      if (s.categories) {
        selectedCategories = s.categories;
      }
      if (s.count && countSelectRef) {
        countSelectRef.value = s.count;
      }
    }

    function saveEmojiSettings() {
      if (!countSelectRef) return;
      const s = { categories: selectedCategories, count: countSelectRef.value };
      saveData('emojiSettings', s);
    }

    function getEmojisForCategories(categories) {
      if (categories.includes('all')) {
        return Object.values(emojis).flat();
      }
      const combined = [];
      categories.forEach(cat => {
        if (emojis[cat]) {
          combined.push(...emojis[cat]);
        }
      });
      return combined;
    }

    function generateEmojis() {
      const count = parseInt(document.getElementById('countSelect').value);
      const grid = document.getElementById('emojiGrid');
      const container = document.getElementById('emojiContainer');

      let selectedEmojis = [];

      // Ë§áÊï∞„Ç´„ÉÜ„Ç¥„É™ÈÅ∏ÊäûÊôÇÔºöÂêÑ„Ç´„ÉÜ„Ç¥„É™„Åã„ÇâÊúÄ‰Ωé1ÂÄã„Åö„Å§
      if (selectedCategories.length > 1 && !selectedCategories.includes('all')) {
        const categoryCount = selectedCategories.length;
        const minLimit = Math.min(categoryCount, count);
        
        // ÂêÑ„Ç´„ÉÜ„Ç¥„É™„Åã„Çâ1ÂÄã„Åö„Å§ÈÅ∏„Å∂
        selectedCategories.forEach(cat => {
          const categoryList = emojis[cat] || [];
          const emoji = categoryList[Math.floor(Math.random() * categoryList.length)];
          selectedEmojis.push(emoji);
        });

        // ÊÆã„Çä„Çí„É©„É≥„ÉÄ„É†„Å´ÈÅ∏„Å∂
        const remaining = count - minLimit;
        const availableEmojis = getEmojisForCategories(selectedCategories);
        for (let i = 0; i < remaining; i++) {
          const emoji = availableEmojis[Math.floor(Math.random() * availableEmojis.length)];
          selectedEmojis.push(emoji);
        }
      } else {
        // „Äå„Åô„Åπ„Å¶„Äç„Åæ„Åü„ÅØÂçò‰∏Ä„Ç´„ÉÜ„Ç¥„É™ÈÅ∏ÊäûÊôÇ
        const availableEmojis = getEmojisForCategories(selectedCategories);
        for (let i = 0; i < count; i++) {
          const emoji = availableEmojis[Math.floor(Math.random() * availableEmojis.length)];
          selectedEmojis.push(emoji);
        }
      }

      grid.innerHTML = '';
      selectedEmojis.forEach(emoji => {
        const item = document.createElement('div');
        item.className = 'emoji-item';
        item.innerHTML = `
          <div class="emoji-large">${sanitizeHTML(emoji)}</div>
          <div class="emoji-name">Copy</div>
        `;
        item.style.cursor = 'pointer';
        item.addEventListener('click', () => {
          copyTextToClipboard(emoji, {
            successMessage: 'üìã „Ç≥„Éî„Éº„Åó„Åæ„Åó„ÅüÔºÅ'
          });
        });
        grid.appendChild(item);
      });

      container.style.display = 'none';
      grid.style.display = 'grid';
      saveEmojiSettings();
    }

    function clearEmojis() {
      const grid = document.getElementById('emojiGrid');
      const container = document.getElementById('emojiContainer');
      grid.innerHTML = '';
      grid.style.display = 'none';
      container.style.display = 'block';
    }

    document.addEventListener('DOMContentLoaded', () => {
      buildNav('emoji');
      buildHistoryNav('emoji-generator-enterprise.html');
      const categoryButtons = document.getElementById('categoryButtons');
      const countSelect = document.getElementById('countSelect');
      const generateBtn = document.getElementById('generateEmojisBtn');
      const clearBtn = document.getElementById('clearEmojisBtn');
      const copyAllBtn = document.getElementById('copyAllBtn');
      const saveImgBtn = document.getElementById('saveImgBtn');
      countSelectRef = countSelect;

      function updateButtonStates() {
        Array.from(categoryButtons.querySelectorAll('.category-btn')).forEach(btn => {
          const category = btn.getAttribute('data-category');
          if (selectedCategories.includes(category) || (category === 'all' && selectedCategories[0] === 'all')) {
            btn.classList.add('active');
          } else {
            btn.classList.remove('active');
          }
        });
      }

      categoryButtons.addEventListener('click', (e) => {
        if (e.target.classList.contains('category-btn')) {
          const category = e.target.getAttribute('data-category');
          if (category === 'all') {
            selectedCategories = ['all'];
          } else {
            selectedCategories = selectedCategories.filter(c => c !== 'all');
            const idx = selectedCategories.indexOf(category);
            if (idx > -1) {
              selectedCategories.splice(idx, 1);
            } else {
              selectedCategories.push(category);
            }
            if (selectedCategories.length === 0) {
              selectedCategories = ['all'];
            }
          }
          updateButtonStates();
          saveEmojiSettings();
        }
      });

      countSelect.addEventListener('change', saveEmojiSettings);
      generateBtn.addEventListener('click', generateEmojis);
      clearBtn.addEventListener('click', clearEmojis);
      copyAllBtn.addEventListener('click', copyAllEmojis);
      saveImgBtn.addEventListener('click', saveEmojisAsImage);

      loadEmojiSettings();
      updateButtonStates();
    });

    function copyAllEmojis() {
      const grid = document.getElementById('emojiGrid');
      const text = Array.from(grid.querySelectorAll('.emoji-large')).map(el => el.textContent).join(' ');
      copyTextToClipboard(text, {
        successMessage: 'üìã „Åô„Åπ„Å¶„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü',
        emptyMessage: '‚ö†Ô∏è ÂÖà„Å´ÁµµÊñáÂ≠ó„ÇíÁîüÊàê„Åó„Å¶„Åè„Å†„Åï„ÅÑ',
        fallbackMessage: '‚ÑπÔ∏è „Ç≥„Éî„Éº‰∏çÂèØ„ÅÆÁí∞Â¢É„Åß„Åô„ÄÇË°®Á§∫„Åï„Çå„ÅüÁµµÊñáÂ≠ó„ÇíÊâãÂãï„Åß„Ç≥„Éî„Éº„Åó„Å¶„Åè„Å†„Åï„ÅÑ'
      });
    }

    function saveEmojisAsImage() {
      const grid = document.getElementById('emojiGrid');
      const emojis = Array.from(grid.querySelectorAll('.emoji-large')).map(el => el.textContent);
      if (emojis.length === 0) return;
      const cols = Math.min(5, emojis.length);
      const rows = Math.ceil(emojis.length / cols);
      const size = 120;
      const canvas = document.createElement('canvas');
      canvas.width = cols * size;
      canvas.height = rows * size;
      const ctx = canvas.getContext('2d');
      ctx.fillStyle = '#fff';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.font = '80px sans-serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      emojis.forEach((e, i) => {
        const x = (i % cols) * size + size / 2;
        const y = Math.floor(i / cols) * size + size / 2;
        ctx.fillText(e, x, y);
      });
      const link = document.createElement('a');
      link.download = 'emojis.png';
      link.href = canvas.toDataURL();
      link.click();
    }
  </script>
</body>
</html>
